<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="iLnn73OYPE8oGpGt16HX4ooi_DyK4Q52wTCGQ96SDfc" />
    <meta name="description" content="Accurate GATE 2026 Rank Predictor based on actual GATE data. Check expected rank, score vs marks, and cutoff analysis for all branches.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5B7D2R8VD0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5B7D2R8VD0');
</script>
    <title>GATE Rank Predictor 2026 | Predict Your Rank, Score & IIT/PSU Chances Instantly</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* 3D Enhanced UI with Crisp Text */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 30px;
        }

        .container {
            width: 90%;
            max-width: 1300px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Header with 3D effect */
        header {
            background: linear-gradient(135deg, var(--primary), #1a2634);
            color: white;
            padding: 30px 50px;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-bottom: 3px solid rgba(255,255,255,0.1);
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            font-size: 3rem;
            color: var(--secondary);
            background: white;
            padding: 15px;
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .logo h1 {
            font-size: 2.2rem;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .logo span {
            color: var(--secondary);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            color: #ecf0f1;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            -webkit-font-smoothing: antialiased;
            margin-top: 5px;
        }

        /* Main Content */
        .main-content {
            padding: 50px;
        }

        /* Input Section */
        .input-section {
            background: #f8f9fa;
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 40px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .input-section:hover {
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }

        .section-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 25px;
        }

        .section-toggle h2 {
            color: var(--primary);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            -webkit-font-smoothing: antialiased;
        }

        /* Option Toggle Buttons */
        .option-toggle {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            background: white;
            padding: 15px;
            border-radius: 60px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
        }

        .option-btn {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: #f0f0f0;
            color: #666;
            -webkit-font-smoothing: antialiased;
        }

        .option-btn i {
            font-size: 1.4rem;
        }

        .option-btn.active {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
        }

        .option-btn:hover:not(.active) {
            background: #e0e0e0;
            transform: scale(1.02);
        }

        .input-panel {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .input-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* URL Upload Section */
        .url-upload-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            border: 2px dashed var(--secondary);
            text-align: center;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .url-upload-section:hover {
            border-color: var(--success);
            background: #f8f9fa;
        }

        .url-icon {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        .url-input-group {
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .url-input-group input {
            width: 100%;
            padding: 18px 25px;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .url-input-group input:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
        }

        .url-example {
            color: #666;
            font-size: 0.9rem;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .url-example i {
            color: var(--warning);
            margin-right: 5px;
        }

        .fetch-btn {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
            margin-top: 20px;
        }

        .fetch-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(46, 204, 113, 0.4);
        }

        .fetch-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .marks-type {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .marks-type:hover {
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .marks-type h4 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
            -webkit-font-smoothing: antialiased;
        }

        .marks-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .marks-grid {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-group label {
            font-weight: 600;
            color: #555;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            -webkit-font-smoothing: antialiased;
        }

        .input-group input, .input-group select {
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            -webkit-font-smoothing: antialiased;
        }

        .input-group input:focus, .input-group select:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2), inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .input-group input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .category-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 600px) {
            .category-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .category-btn {
            padding: 15px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            -webkit-font-smoothing: antialiased;
        }

        .category-btn:hover {
            background: #e0e0e0;
            transform: scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .category-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }

        .quick-buttons {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
            -webkit-font-smoothing: antialiased;
        }

        .quick-btn:hover {
            background: #e0e0e0;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .quick-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .quick-btn:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .predict-container {
            text-align: center;
            margin: 40px 0;
        }

        .predict-btn {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            border: none;
            padding: 22px 50px;
            border-radius: 60px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 20px 40px rgba(52, 152, 219, 0.4);
            border: 1px solid rgba(255,255,255,0.3);
            -webkit-font-smoothing: antialiased;
        }

        .predict-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 30px 60px rgba(52, 152, 219, 0.5);
        }

        .predict-btn:active {
            transform: scale(0.98);
        }

        .predict-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .check-again-btn {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 60px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 15px 30px rgba(243, 156, 18, 0.4);
            border: 1px solid rgba(255,255,255,0.3);
            -webkit-font-smoothing: antialiased;
        }

        .check-again-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 40px rgba(243, 156, 18, 0.5);
        }

        .results-section {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin-top: 30px;
            display: none;
            border: 2px solid var(--secondary);
            animation: slideIn 0.6s ease;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-section.visible {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 3px solid #f0f0f0;
        }

        .results-header h2 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            -webkit-font-smoothing: antialiased;
        }

        .results-method-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 0.95rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .qualification-status {
            text-align: center;
            margin: 30px 0;
            padding: 25px;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .qualification-status:hover {
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .qualified {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(39, 174, 96, 0.05));
            border: 3px solid var(--success);
            box-shadow: 0 15px 30px rgba(39, 174, 96, 0.2);
        }

        .not-qualified {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(231, 76, 60, 0.05));
            border: 3px solid var(--danger);
            box-shadow: 0 15px 30px rgba(231, 76, 60, 0.2);
        }

        .status-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .status-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 15px;
            -webkit-font-smoothing: antialiased;
        }

        .status-details {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.8;
            -webkit-font-smoothing: antialiased;
        }

        .iit-admission {
            background: linear-gradient(135deg, #e8f6f3, #d1f2eb);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border-left: 8px solid #1abc9c;
            box-shadow: 0 15px 30px rgba(26, 188, 156, 0.2);
            transition: all 0.3s;
        }

        .iit-admission:hover {
            box-shadow: 0 25px 50px rgba(26, 188, 156, 0.3);
        }

        .iit-admission h4 {
            color: #0e6251;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            -webkit-font-smoothing: antialiased;
        }

        .iit-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .iit-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .iit-grid {
                grid-template-columns: 1fr;
            }
        }

        .iit-card {
            background: white;
            padding: 25px;
            border-radius: 18px;
            text-align: center;
            border-top: 6px solid #1abc9c;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .iit-card:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .iit-card h5 {
            color: #0e6251;
            margin-bottom: 10px;
            font-size: 1.1rem;
            -webkit-font-smoothing: antialiased;
        }

        .iit-marks {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1abc9c;
            margin: 10px 0;
            -webkit-font-smoothing: antialiased;
        }

        .iit-type {
            font-size: 0.9rem;
            color: #666;
            -webkit-font-smoothing: antialiased;
        }

        .analysis-box {
            background: linear-gradient(135deg, #fff8e1, #ffeaa7);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border-left: 8px solid var(--warning);
            box-shadow: 0 15px 30px rgba(243, 156, 18, 0.2);
            transition: all 0.3s;
        }

        .analysis-box:hover {
            box-shadow: 0 25px 50px rgba(243, 156, 18, 0.3);
        }

        .analysis-box h4 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            -webkit-font-smoothing: antialiased;
        }

        .analysis-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #2c3e50;
            -webkit-font-smoothing: antialiased;
        }

        .excellent {
            color: var(--success);
            font-weight: 700;
        }

        .good {
            color: #3498db;
            font-weight: 700;
        }

        .average {
            color: var(--warning);
            font-weight: 700;
        }

        .improve {
            color: var(--danger);
            font-weight: 700;
        }

        .psu-section {
            background: linear-gradient(135deg, #fff0e1, #ffe3b3);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border-left: 8px solid #e67e22;
            box-shadow: 0 15px 30px rgba(230, 126, 34, 0.2);
            transition: all 0.3s;
        }

        .psu-section:hover {
            box-shadow: 0 25px 50px rgba(230, 126, 34, 0.3);
        }

        .psu-section h4 {
            color: #7d6608;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            -webkit-font-smoothing: antialiased;
        }

        .psu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .psu-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .psu-grid {
                grid-template-columns: 1fr;
            }
        }

        .psu-card {
            background: white;
            padding: 25px;
            border-radius: 18px;
            text-align: center;
            border-top: 6px solid #e67e22;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .psu-card:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .psu-card h5 {
            color: #7d6608;
            margin-bottom: 10px;
            font-size: 1.1rem;
            -webkit-font-smoothing: antialiased;
        }

        .psu-chance {
            font-size: 1.5rem;
            font-weight: 700;
            color: #e67e22;
            margin: 10px 0;
            -webkit-font-smoothing: antialiased;
        }

        .psu-companies {
            font-size: 0.9rem;
            color: #666;
            -webkit-font-smoothing: antialiased;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 35px;
        }

        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border-top: 6px solid var(--secondary);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .result-card:hover {
            transform: scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .result-card h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            -webkit-font-smoothing: antialiased;
        }

        .card-value {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--secondary);
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            -webkit-font-smoothing: antialiased;
        }

        .card-label {
            color: #666;
            font-size: 0.95rem;
            -webkit-font-smoothing: antialiased;
        }

        .cutoff-section {
            background: linear-gradient(135deg, #e8f4fc, #d6eaf8);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border-left: 8px solid var(--secondary);
            box-shadow: 0 15px 30px rgba(52, 152, 219, 0.2);
            transition: all 0.3s;
        }

        .cutoff-section:hover {
            box-shadow: 0 25px 50px rgba(52, 152, 219, 0.3);
        }

        .cutoff-section h4 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            -webkit-font-smoothing: antialiased;
        }

        .cutoff-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .cutoff-table th {
            background: var(--primary);
            color: white;
            padding: 18px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            -webkit-font-smoothing: antialiased;
        }

        .cutoff-table td {
            padding: 18px;
            text-align: center;
            border-bottom: 1px solid #eee;
            -webkit-font-smoothing: antialiased;
        }

        .cutoff-table tr:hover {
            background: #f9f9f9;
        }

        .cutoff-value {
            font-weight: 700;
            color: var(--primary);
        }

        .your-cutoff {
            background: rgba(52, 152, 219, 0.1);
            font-weight: 700;
        }

        .cutoff-diff {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 5px;
            -webkit-font-smoothing: antialiased;
        }

        .graph-section {
            margin-top: 50px;
            background: white;
            padding: 35px;
            border-radius: 25px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            transition: all 0.3s;
        }

        .graph-section:hover {
            box-shadow: 0 30px 60px rgba(0,0,0,0.2);
        }

        .graph-header h3 {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: 10px;
            -webkit-font-smoothing: antialiased;
        }

        .graph-header p {
            color: #666;
            -webkit-font-smoothing: antialiased;
        }

        .graph-container {
            height: 450px;
            position: relative;
        }

        .graph-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .graph-control-btn {
            padding: 12px 24px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            -webkit-font-smoothing: antialiased;
        }

        .graph-control-btn:hover {
            background: #e0e0e0;
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .graph-control-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .share-buttons {
            display: flex;
            gap: 20px;
            margin: 35px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 15px 30px;
            border-radius: 40px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            -webkit-font-smoothing: antialiased;
        }

        .share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 30px rgba(0,0,0,0.2);
        }

        .save-btn {
            background: linear-gradient(135deg, #27ae60, #219653);
            color: white;
        }

        .share-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }

        .share-download {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        footer {
            background: linear-gradient(135deg, var(--primary), #1a2634);
            color: white;
            padding: 40px 50px;
            margin-top: 50px;
            text-align: center;
            border-top: 3px solid rgba(255,255,255,0.1);
        }

        .footer-content h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            -webkit-font-smoothing: antialiased;
        }

        .footer-content p {
            opacity: 0.9;
            -webkit-font-smoothing: antialiased;
        }

        .copyright {
            opacity: 0.95;
            font-size: 1.1rem;
            margin-top: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            -webkit-font-smoothing: antialiased;
        }

        .developer-badge {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            padding: 12px 25px;
            border-radius: 40px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .developer-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 35px rgba(52, 152, 219, 0.5);
        }

        .developer-icon {
            color: white;
            font-size: 1.2rem;
        }

        .developer-name {
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            -webkit-font-smoothing: antialiased;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading i {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 25px;
            animation: spin 1.5s linear infinite;
            filter: drop-shadow(0 10px 15px rgba(52, 152, 219, 0.3));
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: 600;
            -webkit-font-smoothing: antialiased;
        }

        .marks-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 20px;
            margin: 30px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        @media (max-width: 600px) {
            .marks-summary {
                grid-template-columns: 1fr;
            }
        }

        .summary-item {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .summary-item:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
            -webkit-font-smoothing: antialiased;
        }

        .summary-label {
            color: #666;
            font-size: 0.9rem;
            -webkit-font-smoothing: antialiased;
        }

        .note-box {
            background: #fff8e1;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            font-size: 0.95rem;
            border-left: 5px solid var(--warning);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            line-height: 1.6;
        }

        .note-box p {
            color: #555;
            -webkit-font-smoothing: antialiased;
        }

        .note-box i {
            color: var(--warning);
            margin-right: 8px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .main-content {
                padding: 25px;
            }

            .option-toggle {
                flex-direction: column;
                gap: 10px;
            }

            .predict-btn, .check-again-btn {
                padding: 18px 35px;
                font-size: 1.2rem;
            }

            .card-value {
                font-size: 2.2rem;
            }

            header {
                padding: 25px;
            }

            .cutoff-table {
                font-size: 0.95rem;
            }

            .cutoff-table th, .cutoff-table td {
                padding: 12px;
            }

            .share-buttons {
                flex-direction: column;
                align-items: center;
            }

            .share-btn {
                width: 100%;
                max-width: 350px;
                justify-content: center;
            }
        }

        html {
            scroll-behavior: smooth;
        }

        body, button, input, select, textarea, h1, h2, h3, h4, h5, h6, p, span, div {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <div>
                    <h1>GATE RANK <span>PREDICTOR</span> 2026</h1>
                    <p class="subtitle">Predict Your Rank, Score & IIT/PSU Chances Instantly</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Input Section -->
            <div class="input-section">
                <div class="section-toggle">
                    <h2><i class="fas fa-edit"></i> SELECT INPUT METHOD</h2>
                </div>
                
                <!-- Option Toggle Buttons -->
                <div class="option-toggle">
                    <button class="option-btn active" id="manualOption" onclick="switchInputMethod('manual')">
                        <i class="fas fa-pencil-alt"></i> Manual Entry
                    </button>
                    <button class="option-btn" id="urlOption" onclick="switchInputMethod('url')">
                        <i class="fas fa-link"></i> Upload Response Sheet URL
                    </button>
                </div>

                <!-- Manual Entry Panel -->
                <div class="input-panel active" id="manualPanel">
                    <div class="input-group" style="margin-bottom: 20px;">
                        <label><i class="fas fa-file-alt"></i> Select Your Paper</label>
                        <select id="paperManual" onchange="updateMarks()">
                            <option value="CS">Computer Science (CS) - 170888 Students</option>
                            <option value="CE">Civil Engineering (CE) - 79950 Students</option>
                            <option value="ME">Mechanical Engineering (ME) - 62045 Students</option>
                            <option value="EE">Electrical Engineering (EE) - 81470 Students</option>
                            <option value="ECE">Electronics & Comm (ECE) - 60000 Students</option>
                            <option value="DA">Data Science & AI (DA) - 28000 Students</option>
                            <option value="IN">Instrumentation (IN) - 35000 Students</option>
                            <option value="PI">Production & Industrial (PI) - 25000 Students</option>
                            <option value="XE">Engineering Sciences (XE) - 20000 Students</option>
                            <option value="ES">Environmental Science (ES) - 18000 Students</option>
                            <option value="CH">Chemical Engineering (CH) - 30000 Students</option>
                        </select>
                    </div>

                    <div class="marks-type">
                        <h4><i class="fas fa-1"></i> Type 1 Questions (1 Mark Each) - Total 30 Questions</h4>
                        <div class="marks-grid">
                            <div class="input-group">
                                <label>Correct Answers</label>
                                <input type="number" id="type1Correct" min="0" max="30" step="1" value="" placeholder="Enter correct answers" oninput="updateMarks()">
                                <div class="quick-buttons">
                                    <button class="quick-btn" onclick="setValue('type1Correct', 20, event)">20</button>
                                    <button class="quick-btn" onclick="setValue('type1Correct', 25, event)">25</button>
                                    <button class="quick-btn" onclick="setValue('type1Correct', 28, event)">28</button>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>Wrong Answers</label>
                                <input type="number" id="type1Wrong" min="0" max="30" step="1" value="" placeholder="Enter wrong answers" oninput="updateMarks()">
                                <div class="quick-buttons">
                                    <button class="quick-btn" onclick="setValue('type1Wrong', 0, event)">0</button>
                                    <button class="quick-btn" onclick="setValue('type1Wrong', 3, event)">3</button>
                                    <button class="quick-btn" onclick="setValue('type1Wrong', 5, event)">5</button>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                            <i class="fas fa-info-circle"></i> Total 1-mark questions: <span id="type1Total">0</span>/30
                        </div>
                    </div>

                    <div class="marks-type">
                        <h4><i class="fas fa-2"></i> Type 2 Questions (2 Marks Each) - Total 35 Questions</h4>
                        <div class="marks-grid">
                            <div class="input-group">
                                <label>Correct Answers</label>
                                <input type="number" id="type2Correct" min="0" max="35" step="1" value="" placeholder="Enter correct answers" oninput="updateMarks()">
                                <div class="quick-buttons">
                                    <button class="quick-btn" onclick="setValue('type2Correct', 15, event)">15</button>
                                    <button class="quick-btn" onclick="setValue('type2Correct', 20, event)">20</button>
                                    <button class="quick-btn" onclick="setValue('type2Correct', 25, event)">25</button>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>Wrong Answers</label>
                                <input type="number" id="type2Wrong" min="0" max="35" step="1" value="" placeholder="Enter wrong answers" oninput="updateMarks()">
                                <div class="quick-buttons">
                                    <button class="quick-btn" onclick="setValue('type2Wrong', 0, event)">0</button>
                                    <button class="quick-btn" onclick="setValue('type2Wrong', 2, event)">2</button>
                                    <button class="quick-btn" onclick="setValue('type2Wrong', 5, event)">5</button>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                            <i class="fas fa-info-circle"></i> Total 2-mark questions: <span id="type2Total">0</span>/35
                        </div>
                    </div>
                </div>

                <!-- URL Upload Panel -->
                <div class="input-panel" id="urlPanel">
                    <div class="input-group" style="margin-bottom: 20px;">
                        <label><i class="fas fa-file-alt"></i> Select Your Paper</label>
                        <select id="paperURL" onchange="updateURLMarks()">
                            <option value="CS">Computer Science (CS) - 170888 Students</option>
                            <option value="CE">Civil Engineering (CE) - 79950 Students</option>
                            <option value="ME">Mechanical Engineering (ME) - 62045 Students</option>
                            <option value="EE">Electrical Engineering (EE) - 81470 Students</option>
                            <option value="ECE">Electronics & Comm (ECE) - 60000 Students</option>
                            <option value="DA">Data Science & AI (DA) - 28000 Students</option>
                            <option value="IN">Instrumentation (IN) - 35000 Students</option>
                            <option value="PI">Production & Industrial (PI) - 25000 Students</option>
                            <option value="XE">Engineering Sciences (XE) - 20000 Students</option>
                            <option value="ES">Environmental Science (ES) - 18000 Students</option>
                            <option value="CH">Chemical Engineering (CH) - 30000 Students</option>
                        </select>
                    </div>

                    <div class="url-upload-section">
                        <div class="url-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3 style="color: var(--primary); margin-bottom: 15px;">Upload GATE 2026 Response Sheet URL</h3>
                        <p style="color: #666; margin-bottom: 25px;">Enter the official GATE 2026 response sheet URL to automatically fetch your answers</p>
                        
                        <div class="url-input-group">
                            <input type="url" id="responseSheetUrl" placeholder="https://gate2026.iisc.ac.in/response/..." value="">
                        </div>
                        
                        <div class="url-example">
                            <i class="fas fa-info-circle"></i> 
                            Example: https://gate2026.iisc.ac.in/response/CS12345678
                        </div>

                        <button class="fetch-btn" id="fetchBtn" onclick="fetchResponseSheet()">
                            <i class="fas fa-download"></i> FETCH & ANALYZE RESPONSES
                        </button>
                    </div>

                    <div id="urlFetchedData" style="display: none;">
                        <div class="marks-type">
                            <h4><i class="fas fa-check-circle" style="color: var(--success);"></i> Fetched Response Data</h4>
                            <div class="marks-summary" style="grid-template-columns: repeat(2, 1fr);">
                                <div class="summary-item">
                                    <div class="summary-label">Type 1 Correct</div>
                                    <div class="summary-value" id="urlType1Correct">0</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Type 1 Wrong</div>
                                    <div class="summary-value" id="urlType1Wrong">0</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Type 2 Correct</div>
                                    <div class="summary-value" id="urlType2Correct">0</div>
                                </div>
                                <div class="summary-item">
                                    <div class="summary-label">Type 2 Wrong</div>
                                    <div class="summary-value" id="urlType2Wrong">0</div>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 15px;">
                                <span style="background: var(--success); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">
                                    <i class="fas fa-check"></i> Data Fetched Successfully
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Category Selection (Common for both panels) -->
                <div class="input-group">
                    <label><i class="fas fa-users"></i> Select Your Category</label>
                    <div class="category-buttons">
                        <button class="category-btn active" onclick="selectCategory('GEN', event)">General</button>
                        <button class="category-btn" onclick="selectCategory('OBC', event)">OBC-NCL</button>
                        <button class="category-btn" onclick="selectCategory('EWS', event)">EWS</button>
                        <button class="category-btn" onclick="selectCategory('SC', event)">SC</button>
                        <button class="category-btn" onclick="selectCategory('ST', event)">ST</button>
                        <button class="category-btn" onclick="selectCategory('PWD', event)">PwD</button>
                    </div>
                    <input type="hidden" id="category" value="GEN">
                </div>

                <div class="note-box">
                    <p><i class="fas fa-info-circle"></i> This is your estimated marks, expected score, and predicted rank based on available data and analysis. The actual GATE result may vary according to the official evaluation and calculation by the exam authorities.</p>
                </div>
            </div>

            <!-- Predict Button -->
            <div class="predict-container">
                <button class="predict-btn" id="predictBtn" onclick="predictRank()">
                    <i class="fas fa-bolt"></i> PREDICT MY RANK & ANALYSIS
                </button>
            </div>

            <!-- Loading Animation -->
            <div class="loading" id="loading">
                <i class="fas fa-spinner"></i>
                <p>Analyzing your marks...</p>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <div class="results-header">
                    <h2><i class="fas fa-chart-line"></i> Your GATE 2026 Prediction Results</h2>
                    <p>Based on available data and analysis</p>
                    <div class="results-method-badge" id="resultsMethodBadge">
                        <i class="fas fa-pencil-alt"></i> Manual Entry
                    </div>
                </div>

                <!-- Share Buttons -->
                <div class="share-buttons">
                    <button class="share-btn save-btn" onclick="saveResult()">
                        <i class="fas fa-save"></i> SAVE RESULT
                    </button>
                    <button class="share-btn share-whatsapp" onclick="shareWhatsApp()">
                        <i class="fab fa-whatsapp"></i> SHARE ON WHATSAPP
                    </button>
                    <button class="share-btn share-download" onclick="downloadResult()">
                        <i class="fas fa-download"></i> DOWNLOAD AS IMAGE
                    </button>
                </div>

                <!-- Qualification Status -->
                <div class="qualification-status" id="qualificationStatus">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Marks Summary -->
                <div class="marks-summary">
                    <div class="summary-item">
                        <div class="summary-label">Type 1 Marks</div>
                        <div class="summary-value" id="type1Marks">0.00</div>
                        <div class="summary-label" id="type1Details">0✓ 0✗</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Type 2 Marks</div>
                        <div class="summary-value" id="type2Marks">0.00</div>
                        <div class="summary-label" id="type2Details">0✓ 0✗</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total Marks</div>
                        <div class="summary-value" id="totalMarks">0.00</div>
                        <div class="summary-label">Out of 100</div>
                    </div>
                </div>

                <!-- Results Grid -->
                <div class="results-grid">
                    <div class="result-card">
                        <h4><i class="fas fa-trophy"></i> Expected Rank</h4>
                        <div class="card-value" id="predictedRank">--</div>
                        <div class="card-label">All India Rank</div>
                    </div>

                    <div class="result-card">
                        <h4><i class="fas fa-star"></i> GATE Score</h4>
                        <div class="card-value" id="predictedScore">--</div>
                        <div class="card-label">Out of 1000</div>
                    </div>

                    <div class="result-card">
                        <h4><i class="fas fa-percentage"></i> Percentile</h4>
                        <div class="card-value" id="percentile">--</div>
                        <div class="card-label">Approximate</div>
                    </div>

                    <div class="result-card">
                        <h4><i class="fas fa-chart-bar"></i> Rank Range</h4>
                        <div class="card-value" id="rankRange">--</div>
                        <div class="card-label">±15% variation</div>
                    </div>
                </div>

                <!-- IIT Admission Section -->
                <div class="iit-admission" id="iitAdmissionSection">
                    <h4><i class="fas fa-university"></i> IIT Admission Chances (Based on Your Category)</h4>
                    <div id="iitGridContainer">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Analysis Box -->
                <div class="analysis-box">
                    <h4><i class="fas fa-lightbulb"></i> Analysis & Insights</h4>
                    <div class="analysis-text" id="analysisText">
                        Enter your marks and click predict to see detailed analysis...
                    </div>
                </div>

                <!-- PSU Chances Section -->
                <div class="psu-section" id="psuSection">
                    <h4><i class="fas fa-building"></i> PSU Recruitment Chances</h4>
                    <div id="psuGridContainer">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Cutoff Section -->
                <div class="cutoff-section">
                    <h4><i class="fas fa-flag-checkered"></i> GATE 2026 Expected Cutoff Marks (Based on 2022-2025 Trends)</h4>
                    <div id="cutoffTableContainer">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Interactive Graph Section -->
                <div class="graph-section">
                    <div class="graph-header">
                        <h3><i class="fas fa-chart-line"></i> Rank vs Marks Curve</h3>
                        <p>Hover over points to see exact values • Click and drag to zoom • Double-click to reset</p>
                    </div>
                    <div class="graph-container">
                        <canvas id="rankChart"></canvas>
                    </div>
                    <div class="graph-controls">
                        <button class="graph-control-btn active" onclick="setGraphView('all')">All Data</button>
                        <button class="graph-control-btn" onclick="setGraphView('top')">Top 10,000</button>
                        <button class="graph-control-btn" onclick="setGraphView('yourRegion')">Your Region</button>
                        <button class="graph-control-btn" onclick="exportGraph()">Export Graph</button>
                    </div>
                </div>

                <!-- Check Again Button -->
                <div style="text-align: center; margin-top: 30px;">
                    <button class="check-again-btn" onclick="checkAgain()">
                        <i class="fas fa-redo"></i> CHECK AGAIN WITH DIFFERENT MARKS
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <h3>GATE Rank Predictor 2026</h3>
                <p>Predict Your Rank, Score & IIT/PSU Chances Instantly</p>
                <div class="copyright">
                    <i class="fas fa-copyright"></i> 2026 GATE Rank Predictor
                    <div class="developer-badge">
                        <i class="fas fa-code developer-icon"></i>
                        <span class="developer-name">Developed by RAJ BITTU</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // =====================================================
        // TOTAL STUDENTS DATA FOR EACH BRANCH (GATE 2025)
        // =====================================================
        
        const totalStudentsByBranch = {
            "CS": 170888,  // Computer Science
            "CE": 79950,   // Civil Engineering
            "EE": 81470,   // Electrical Engineering
            "ECE": 60000,  // Electronics & Communication
            "ME": 62045,   // Mechanical Engineering
            "DA": 28000,   // Data Science & AI
            "IN": 35000,   // Instrumentation Engineering
            "PI": 25000,   // Production & Industrial Engg
            "XE": 20000,   // Engineering Sciences
            "ES": 18000,   // Environmental Science
            "CH": 30000    // Chemical Engineering
        };

        // Apply 12% increase for 2026 projections
        const totalStudents2026 = {};
        for (const [branch, count] of Object.entries(totalStudentsByBranch)) {
            totalStudents2026[branch] = Math.round(count * 1.12);
        }

        // =====================================================
        // BRANCH-SPECIFIC DATA FOR RANK CALCULATION
        // =====================================================
        
        // Computer Science (CS) - Most competitive
        const csData = [
            { rank: 1, marks: 100.00, score: 1000 },
            { rank: 10, marks: 92.50, score: 985 },
            { rank: 50, marks: 87.30, score: 950 },
            { rank: 100, marks: 83.20, score: 920 },
            { rank: 200, marks: 78.90, score: 890 },
            { rank: 300, marks: 75.60, score: 865 },
            { rank: 400, marks: 72.80, score: 840 },
            { rank: 500, marks: 70.50, score: 820 },
            { rank: 600, marks: 68.40, score: 800 },
            { rank: 700, marks: 66.50, score: 785 },
            { rank: 800, marks: 64.80, score: 770 },
            { rank: 900, marks: 63.20, score: 755 },
            { rank: 1000, marks: 61.70, score: 740 },
            { rank: 1200, marks: 59.30, score: 720 },
            { rank: 1500, marks: 56.80, score: 695 },
            { rank: 1800, marks: 54.60, score: 675 },
            { rank: 2000, marks: 53.20, score: 660 },
            { rank: 2500, marks: 50.40, score: 635 },
            { rank: 3000, marks: 48.10, score: 615 },
            { rank: 4000, marks: 44.90, score: 585 },
            { rank: 5000, marks: 42.30, score: 560 },
            { rank: 6000, marks: 40.10, score: 540 },
            { rank: 7000, marks: 38.20, score: 520 },
            { rank: 8000, marks: 36.50, score: 505 },
            { rank: 9000, marks: 34.90, score: 490 },
            { rank: 10000, marks: 33.50, score: 475 },
            { rank: 12000, marks: 31.20, score: 455 },
            { rank: 15000, marks: 28.80, score: 430 },
            { rank: 18000, marks: 26.70, score: 405 },
            { rank: 20000, marks: 25.30, score: 390 },
            { rank: 25000, marks: 22.80, score: 360 },
            { rank: 30000, marks: 20.60, score: 335 },
            { rank: 35000, marks: 18.70, score: 310 },
            { rank: 40000, marks: 16.90, score: 285 },
            { rank: 50000, marks: 14.20, score: 250 },
            { rank: 60000, marks: 11.80, score: 215 },
            { rank: 70000, marks: 9.70, score: 180 },
            { rank: 80000, marks: 7.80, score: 150 },
            { rank: 90000, marks: 6.10, score: 120 },
            { rank: 100000, marks: 4.50, score: 95 },
            { rank: 120000, marks: 2.80, score: 70 },
            { rank: 140000, marks: 1.50, score: 45 },
            { rank: 160000, marks: 0.80, score: 25 },
            { rank: 170888, marks: 0.10, score: 10 }
        ];

        // Civil Engineering (CE)
        const ceData = [
            { rank: 1, marks: 85.50, score: 950 },
            { rank: 10, marks: 79.30, score: 905 },
            { rank: 50, marks: 72.80, score: 860 },
            { rank: 100, marks: 68.20, score: 825 },
            { rank: 200, marks: 63.50, score: 785 },
            { rank: 300, marks: 60.10, score: 755 },
            { rank: 400, marks: 57.30, score: 730 },
            { rank: 500, marks: 54.80, score: 710 },
            { rank: 600, marks: 52.60, score: 690 },
            { rank: 700, marks: 50.70, score: 670 },
            { rank: 800, marks: 48.90, score: 655 },
            { rank: 900, marks: 47.30, score: 640 },
            { rank: 1000, marks: 45.80, score: 625 },
            { rank: 1200, marks: 43.40, score: 605 },
            { rank: 1500, marks: 40.60, score: 580 },
            { rank: 2000, marks: 37.20, score: 550 },
            { rank: 2500, marks: 34.50, score: 525 },
            { rank: 3000, marks: 32.20, score: 505 },
            { rank: 4000, marks: 28.90, score: 475 },
            { rank: 5000, marks: 26.30, score: 450 },
            { rank: 6000, marks: 24.10, score: 430 },
            { rank: 7000, marks: 22.20, score: 410 },
            { rank: 8000, marks: 20.50, score: 395 },
            { rank: 9000, marks: 18.90, score: 380 },
            { rank: 10000, marks: 17.50, score: 365 },
            { rank: 12000, marks: 15.20, score: 345 },
            { rank: 15000, marks: 12.80, score: 320 },
            { rank: 20000, marks: 10.30, score: 285 },
            { rank: 25000, marks: 8.40, score: 255 },
            { rank: 30000, marks: 6.90, score: 225 },
            { rank: 35000, marks: 5.60, score: 200 },
            { rank: 40000, marks: 4.50, score: 175 },
            { rank: 45000, marks: 3.50, score: 150 },
            { rank: 50000, marks: 2.70, score: 125 },
            { rank: 60000, marks: 1.80, score: 90 },
            { rank: 70000, marks: 1.00, score: 60 },
            { rank: 79950, marks: 0.30, score: 25 }
        ];

        // Electrical Engineering (EE)
        const eeData = [
            { rank: 1, marks: 87.20, score: 960 },
            { rank: 10, marks: 81.10, score: 915 },
            { rank: 50, marks: 74.50, score: 870 },
            { rank: 100, marks: 69.80, score: 835 },
            { rank: 200, marks: 64.90, score: 795 },
            { rank: 300, marks: 61.40, score: 765 },
            { rank: 400, marks: 58.60, score: 740 },
            { rank: 500, marks: 56.10, score: 720 },
            { rank: 600, marks: 53.80, score: 700 },
            { rank: 700, marks: 51.80, score: 680 },
            { rank: 800, marks: 50.00, score: 665 },
            { rank: 900, marks: 48.40, score: 650 },
            { rank: 1000, marks: 46.90, score: 635 },
            { rank: 1200, marks: 44.50, score: 615 },
            { rank: 1500, marks: 41.60, score: 590 },
            { rank: 2000, marks: 38.10, score: 560 },
            { rank: 2500, marks: 35.30, score: 535 },
            { rank: 3000, marks: 33.00, score: 515 },
            { rank: 4000, marks: 29.60, score: 485 },
            { rank: 5000, marks: 27.00, score: 460 },
            { rank: 6000, marks: 24.80, score: 440 },
            { rank: 7000, marks: 22.90, score: 420 },
            { rank: 8000, marks: 21.20, score: 405 },
            { rank: 9000, marks: 19.60, score: 390 },
            { rank: 10000, marks: 18.20, score: 375 },
            { rank: 12000, marks: 15.90, score: 355 },
            { rank: 15000, marks: 13.50, score: 330 },
            { rank: 20000, marks: 11.00, score: 295 },
            { rank: 25000, marks: 9.10, score: 265 },
            { rank: 30000, marks: 7.60, score: 235 },
            { rank: 35000, marks: 6.30, score: 210 },
            { rank: 40000, marks: 5.20, score: 185 },
            { rank: 45000, marks: 4.20, score: 160 },
            { rank: 50000, marks: 3.40, score: 135 },
            { rank: 60000, marks: 2.20, score: 100 },
            { rank: 70000, marks: 1.30, score: 65 },
            { rank: 80000, marks: 0.60, score: 35 },
            { rank: 81470, marks: 0.20, score: 15 }
        ];

        // Electronics & Communication (ECE)
        const eceData = [
            { rank: 1, marks: 86.80, score: 955 },
            { rank: 10, marks: 80.70, score: 910 },
            { rank: 50, marks: 74.20, score: 865 },
            { rank: 100, marks: 69.50, score: 830 },
            { rank: 200, marks: 64.60, score: 790 },
            { rank: 300, marks: 61.10, score: 760 },
            { rank: 400, marks: 58.30, score: 735 },
            { rank: 500, marks: 55.80, score: 715 },
            { rank: 600, marks: 53.50, score: 695 },
            { rank: 700, marks: 51.50, score: 675 },
            { rank: 800, marks: 49.70, score: 660 },
            { rank: 900, marks: 48.10, score: 645 },
            { rank: 1000, marks: 46.60, score: 630 },
            { rank: 1200, marks: 44.20, score: 610 },
            { rank: 1500, marks: 41.30, score: 585 },
            { rank: 2000, marks: 37.80, score: 555 },
            { rank: 2500, marks: 35.00, score: 530 },
            { rank: 3000, marks: 32.70, score: 510 },
            { rank: 4000, marks: 29.30, score: 480 },
            { rank: 5000, marks: 26.70, score: 455 },
            { rank: 6000, marks: 24.50, score: 435 },
            { rank: 7000, marks: 22.60, score: 415 },
            { rank: 8000, marks: 20.90, score: 400 },
            { rank: 9000, marks: 19.30, score: 385 },
            { rank: 10000, marks: 17.90, score: 370 },
            { rank: 12000, marks: 15.60, score: 350 },
            { rank: 15000, marks: 13.20, score: 325 },
            { rank: 20000, marks: 10.70, score: 290 },
            { rank: 25000, marks: 8.80, score: 260 },
            { rank: 30000, marks: 7.30, score: 230 },
            { rank: 35000, marks: 6.00, score: 205 },
            { rank: 40000, marks: 4.90, score: 180 },
            { rank: 45000, marks: 3.90, score: 155 },
            { rank: 50000, marks: 3.10, score: 130 },
            { rank: 60000, marks: 1.80, score: 90 }
        ];

        // Mechanical Engineering (ME)
        const meData = [
            { rank: 1, marks: 84.90, score: 945 },
            { rank: 10, marks: 78.80, score: 900 },
            { rank: 50, marks: 72.30, score: 855 },
            { rank: 100, marks: 67.60, score: 820 },
            { rank: 200, marks: 62.70, score: 780 },
            { rank: 300, marks: 59.20, score: 750 },
            { rank: 400, marks: 56.40, score: 725 },
            { rank: 500, marks: 53.90, score: 705 },
            { rank: 600, marks: 51.60, score: 685 },
            { rank: 700, marks: 49.60, score: 665 },
            { rank: 800, marks: 47.80, score: 650 },
            { rank: 900, marks: 46.20, score: 635 },
            { rank: 1000, marks: 44.70, score: 620 },
            { rank: 1200, marks: 42.30, score: 600 },
            { rank: 1500, marks: 39.40, score: 575 },
            { rank: 2000, marks: 35.90, score: 545 },
            { rank: 2500, marks: 33.10, score: 520 },
            { rank: 3000, marks: 30.80, score: 500 },
            { rank: 4000, marks: 27.40, score: 470 },
            { rank: 5000, marks: 24.80, score: 445 },
            { rank: 6000, marks: 22.60, score: 425 },
            { rank: 7000, marks: 20.70, score: 405 },
            { rank: 8000, marks: 19.00, score: 390 },
            { rank: 9000, marks: 17.40, score: 375 },
            { rank: 10000, marks: 16.00, score: 360 },
            { rank: 12000, marks: 13.70, score: 340 },
            { rank: 15000, marks: 11.30, score: 315 },
            { rank: 20000, marks: 8.80, score: 280 },
            { rank: 25000, marks: 6.90, score: 250 },
            { rank: 30000, marks: 5.40, score: 220 },
            { rank: 35000, marks: 4.10, score: 195 },
            { rank: 40000, marks: 3.00, score: 170 },
            { rank: 45000, marks: 2.00, score: 145 },
            { rank: 50000, marks: 1.20, score: 115 },
            { rank: 60000, marks: 0.50, score: 70 },
            { rank: 62045, marks: 0.20, score: 35 }
        ];

        // Data Science & AI (DA)
        const daData = [
            { rank: 1, marks: 88.50, score: 965 },
            { rank: 10, marks: 82.40, score: 920 },
            { rank: 50, marks: 75.80, score: 875 },
            { rank: 100, marks: 71.10, score: 840 },
            { rank: 200, marks: 66.20, score: 800 },
            { rank: 300, marks: 62.70, score: 770 },
            { rank: 400, marks: 59.90, score: 745 },
            { rank: 500, marks: 57.40, score: 725 },
            { rank: 600, marks: 55.10, score: 705 },
            { rank: 700, marks: 53.10, score: 685 },
            { rank: 800, marks: 51.30, score: 670 },
            { rank: 900, marks: 49.70, score: 655 },
            { rank: 1000, marks: 48.20, score: 640 },
            { rank: 1200, marks: 45.80, score: 620 },
            { rank: 1500, marks: 42.90, score: 595 },
            { rank: 2000, marks: 39.40, score: 565 },
            { rank: 2500, marks: 36.60, score: 540 },
            { rank: 3000, marks: 34.30, score: 520 },
            { rank: 4000, marks: 30.90, score: 490 },
            { rank: 5000, marks: 28.30, score: 465 },
            { rank: 6000, marks: 26.10, score: 445 },
            { rank: 7000, marks: 24.20, score: 425 },
            { rank: 8000, marks: 22.50, score: 410 },
            { rank: 9000, marks: 20.90, score: 395 },
            { rank: 10000, marks: 19.50, score: 380 },
            { rank: 12000, marks: 17.20, score: 360 },
            { rank: 15000, marks: 14.80, score: 335 },
            { rank: 18000, marks: 12.90, score: 310 },
            { rank: 20000, marks: 11.70, score: 290 },
            { rank: 22000, marks: 10.50, score: 270 },
            { rank: 25000, marks: 8.80, score: 240 },
            { rank: 28000, marks: 6.50, score: 195 }
        ];

        // Instrumentation Engineering (IN) - Similar to EE but slightly easier
        const inData = eeData.map(d => ({ 
            ...d, 
            marks: d.marks * 0.96,
            score: Math.round(d.score * 0.96)
        }));

        // Production & Industrial (PI) - Similar to ME but slightly easier
        const piData = meData.map(d => ({ 
            ...d, 
            marks: d.marks * 0.95,
            score: Math.round(d.score * 0.95)
        }));

        // Engineering Sciences (XE) - Similar to ME but easier
        const xeData = meData.map(d => ({ 
            ...d, 
            marks: d.marks * 0.92,
            score: Math.round(d.score * 0.92)
        }));

        // Environmental Science (ES) - Similar to CE but easier
        const esData = ceData.map(d => ({ 
            ...d, 
            marks: d.marks * 0.90,
            score: Math.round(d.score * 0.90)
        }));

        // Chemical Engineering (CH) - Similar to CE
        const chData = ceData.map(d => ({ 
            ...d, 
            marks: d.marks * 0.94,
            score: Math.round(d.score * 0.94)
        }));

        // Combine all branch data
        const branchData = {
            "CS": csData,
            "CE": ceData,
            "EE": eeData,
            "ECE": eceData,
            "ME": meData,
            "DA": daData,
            "IN": inData,
            "PI": piData,
            "XE": xeData,
            "ES": esData,
            "CH": chData
        };

        // =====================================================
        // GATE 2026 CUTOFFS (Based on branch difficulty)
        // =====================================================
        
        const gateCutoffs2026 = {
            "CS": { GEN: "29-31", OBC: "26-28", SC: "19-21", ST: "19-21", PWD: "19-21", EWS: "26-28" },
            "CE": { GEN: "24-26", OBC: "21-23", SC: "15-17", ST: "15-17", PWD: "15-17", EWS: "21-23" },
            "ME": { GEN: "25-27", OBC: "22-24", SC: "16-18", ST: "16-18", PWD: "16-18", EWS: "22-24" },
            "EE": { GEN: "23-25", OBC: "20-22", SC: "14-16", ST: "14-16", PWD: "14-16", EWS: "20-22" },
            "ECE": { GEN: "24-26", OBC: "21-23", SC: "15-17", ST: "15-17", PWD: "15-17", EWS: "21-23" },
            "DA": { GEN: "30-32", OBC: "27-29", SC: "20-22", ST: "20-22", PWD: "20-22", EWS: "27-29" },
            "IN": { GEN: "22-24", OBC: "19-21", SC: "13-15", ST: "13-15", PWD: "13-15", EWS: "19-21" },
            "PI": { GEN: "20-22", OBC: "17-19", SC: "11-13", ST: "11-13", PWD: "11-13", EWS: "17-19" },
            "XE": { GEN: "18-20", OBC: "15-17", SC: "9-11", ST: "9-11", PWD: "9-11", EWS: "15-17" },
            "ES": { GEN: "16-18", OBC: "13-15", SC: "7-9", ST: "7-9", PWD: "7-9", EWS: "13-15" },
            "CH": { GEN: "21-23", OBC: "18-20", SC: "12-14", ST: "12-14", PWD: "12-14", EWS: "18-20" }
        };

        const gateCutoffsMid = {
            "CS": { GEN: 30.0, OBC: 27.0, SC: 20.0, ST: 20.0, PWD: 20.0, EWS: 27.0 },
            "CE": { GEN: 25.0, OBC: 22.0, SC: 16.0, ST: 16.0, PWD: 16.0, EWS: 22.0 },
            "ME": { GEN: 26.0, OBC: 23.0, SC: 17.0, ST: 17.0, PWD: 17.0, EWS: 23.0 },
            "EE": { GEN: 24.0, OBC: 21.0, SC: 15.0, ST: 15.0, PWD: 15.0, EWS: 21.0 },
            "ECE": { GEN: 25.0, OBC: 22.0, SC: 16.0, ST: 16.0, PWD: 16.0, EWS: 22.0 },
            "DA": { GEN: 31.0, OBC: 28.0, SC: 21.0, ST: 21.0, PWD: 21.0, EWS: 28.0 },
            "IN": { GEN: 23.0, OBC: 20.0, SC: 14.0, ST: 14.0, PWD: 14.0, EWS: 20.0 },
            "PI": { GEN: 21.0, OBC: 18.0, SC: 12.0, ST: 12.0, PWD: 12.0, EWS: 18.0 },
            "XE": { GEN: 19.0, OBC: 16.0, SC: 10.0, ST: 10.0, PWD: 10.0, EWS: 16.0 },
            "ES": { GEN: 17.0, OBC: 14.0, SC: 8.0, ST: 8.0, PWD: 8.0, EWS: 14.0 },
            "CH": { GEN: 22.0, OBC: 19.0, SC: 13.0, ST: 13.0, PWD: 13.0, EWS: 19.0 }
        };

        // IIT Admission Marks by Category
        const iitAdmissionRanges = {
            "CS": {
                "GEN": { top: "65-70+", middle: "55-65", lower: "45-55" },
                "OBC": { top: "60-65", middle: "50-60", lower: "40-50" },
                "EWS": { top: "60-65", middle: "50-60", lower: "40-50" },
                "SC": { top: "48-53", middle: "38-48", lower: "30-38" },
                "ST": { top: "45-50", middle: "35-45", lower: "28-35" },
                "PWD": { top: "40-45", middle: "30-40", lower: "25-30" }
            },
            "CE": {
                "GEN": { top: "60-65+", middle: "50-60", lower: "40-50" },
                "OBC": { top: "55-60", middle: "45-55", lower: "35-45" },
                "EWS": { top: "55-60", middle: "45-55", lower: "35-45" },
                "SC": { top: "45-50", middle: "35-45", lower: "28-35" },
                "ST": { top: "42-47", middle: "32-42", lower: "25-32" },
                "PWD": { top: "38-43", middle: "28-38", lower: "22-28" }
            },
            "ME": {
                "GEN": { top: "58-63+", middle: "48-58", lower: "38-48" },
                "OBC": { top: "53-58", middle: "43-53", lower: "33-43" },
                "EWS": { top: "53-58", middle: "43-53", lower: "33-43" },
                "SC": { top: "43-48", middle: "33-43", lower: "26-33" },
                "ST": { top: "40-45", middle: "30-40", lower: "23-30" },
                "PWD": { top: "36-41", middle: "26-36", lower: "20-26" }
            }
        };

        // PSU Chances Data
        const psuChancesData = {
            "CS": [
                { marks: "75+", chance: "Very High", companies: "ISRO, DRDO, BARC, BEL, Google, Microsoft" },
                { marks: "65-75", chance: "High", companies: "NTPC, ONGC, GAIL, BHEL, IOCL" },
                { marks: "55-65", chance: "Moderate", companies: "HPCL, BPCL, SAIL, NPCIL" },
                { marks: "45-55", chance: "Low-Moderate", companies: "State PSUs, Power Grid" },
                { marks: "35-45", chance: "Low", companies: "State PSUs, Private Sector" },
                { marks: "25-35", chance: "Very Low", companies: "Private Sector" },
                { marks: "<25", chance: "Unlikely", companies: "Private Sector" }
            ],
            "CE": [
                { marks: "70+", chance: "Very High", companies: "NHAI, NBCC, DRDO, BHEL" },
                { marks: "60-70", chance: "High", companies: "ONGC, IOCL, GAIL, SAIL" },
                { marks: "50-60", chance: "Moderate", companies: "NTPC, PGCIL, State PSUs" },
                { marks: "40-50", chance: "Low-Moderate", companies: "State PWD, Municipal Corp" },
                { marks: "30-40", chance: "Low", companies: "Private Construction" },
                { marks: "<30", chance: "Unlikely", companies: "Private Sector" }
            ],
            "ME": [
                { marks: "68+", chance: "Very High", companies: "BHEL, DRDO, ISRO, NTPC" },
                { marks: "58-68", chance: "High", companies: "ONGC, GAIL, SAIL, IOCL" },
                { marks: "48-58", chance: "Moderate", companies: "BPCL, HPCL, NPCIL" },
                { marks: "38-48", chance: "Low-Moderate", companies: "State PSUs, Automotive" },
                { marks: "28-38", chance: "Low", companies: "Private Manufacturing" },
                { marks: "<28", chance: "Unlikely", companies: "Private Sector" }
            ]
        };

        // Default PSU data for other branches
        psuChancesData["EE"] = psuChancesData["CS"];
        psuChancesData["ECE"] = psuChancesData["CS"];
        psuChancesData["DA"] = psuChancesData["CS"];
        psuChancesData["IN"] = psuChancesData["EE"];
        psuChancesData["PI"] = psuChancesData["ME"];
        psuChancesData["XE"] = psuChancesData["ME"];
        psuChancesData["ES"] = psuChancesData["CE"];
        psuChancesData["CH"] = psuChancesData["CE"];

        // State variables
        let currentInputMethod = 'manual';
        let currentCategory = 'GEN';
        let currentPredictionData = null;
        let currentGraphView = 'all';
        let rankChart = null;
        let urlFetchedData = {
            type1Correct: 0,
            type1Wrong: 0,
            type2Correct: 0,
            type2Wrong: 0
        };

        // =====================================================
        // UTILITY FUNCTIONS
        // =====================================================

        // Switch input method
        function switchInputMethod(method) {
            currentInputMethod = method;
            
            document.getElementById('manualOption').classList.toggle('active', method === 'manual');
            document.getElementById('urlOption').classList.toggle('active', method === 'url');
            
            document.getElementById('manualPanel').classList.toggle('active', method === 'manual');
            document.getElementById('urlPanel').classList.toggle('active', method === 'url');
            
            if (document.getElementById('resultsSection').classList.contains('visible')) {
                const badge = document.getElementById('resultsMethodBadge');
                if (method === 'manual') {
                    badge.innerHTML = '<i class="fas fa-pencil-alt"></i> Manual Entry';
                } else {
                    badge.innerHTML = '<i class="fas fa-link"></i> URL Upload';
                }
            }
        }

        // Select category
        function selectCategory(category, event) {
            currentCategory = category;
            document.getElementById('category').value = category;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (currentInputMethod === 'manual') {
                updateMarks();
            } else {
                updateURLMarks();
            }
        }

        // Set value for manual entry
        function setValue(elementId, value, event) {
            const inputElement = document.getElementById(elementId);
            const otherElementId = elementId.includes('Correct') ? 
                                  elementId.replace('Correct', 'Wrong') : 
                                  elementId.replace('Wrong', 'Correct');
            const otherElement = document.getElementById(otherElementId);
            
            const totalLimit = elementId.includes('type1') ? 30 : 35;
            const currentOtherValue = parseInt(otherElement.value) || 0;
            const newTotal = currentOtherValue + value;
            
            if (newTotal > totalLimit) {
                const excess = newTotal - totalLimit;
                otherElement.value = Math.max(0, currentOtherValue - excess);
                inputElement.value = value;
            } else {
                inputElement.value = value;
            }
            
            const parentDiv = inputElement.closest('.input-group');
            if (parentDiv) {
                parentDiv.querySelectorAll('.quick-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            updateMarks();
        }

        // Update marks calculation for manual entry
        function updateMarks() {
            if (currentInputMethod !== 'manual') return;
            
            const type1Correct = parseInt(document.getElementById('type1Correct').value) || 0;
            const type1Wrong = parseInt(document.getElementById('type1Wrong').value) || 0;
            const type2Correct = parseInt(document.getElementById('type2Correct').value) || 0;
            const type2Wrong = parseInt(document.getElementById('type2Wrong').value) || 0;
            
            const type1Total = type1Correct + type1Wrong;
            const type2Total = type2Correct + type2Wrong;
            
            document.getElementById('type1Total').textContent = type1Total;
            document.getElementById('type2Total').textContent = type2Total;
            
            if (type1Total > 30) {
                document.getElementById('type1Total').style.color = 'var(--danger)';
                document.getElementById('type1Total').style.fontWeight = 'bold';
            } else {
                document.getElementById('type1Total').style.color = '#666';
                document.getElementById('type1Total').style.fontWeight = 'normal';
            }
            
            if (type2Total > 35) {
                document.getElementById('type2Total').style.color = 'var(--danger)';
                document.getElementById('type2Total').style.fontWeight = 'bold';
            } else {
                document.getElementById('type2Total').style.color = '#666';
                document.getElementById('type2Total').style.fontWeight = 'normal';
            }
            
            const type1Marks = type1Correct - (type1Wrong * 0.33);
            const type2Marks = (type2Correct * 2) - (type2Wrong * 0.67);
            const totalMarks = type1Marks + type2Marks;
            
            document.getElementById('type1Marks').textContent = type1Marks.toFixed(2);
            document.getElementById('type2Marks').textContent = type2Marks.toFixed(2);
            document.getElementById('totalMarks').textContent = totalMarks.toFixed(2);
            document.getElementById('type1Details').textContent = `${type1Correct}✓ ${type1Wrong}✗`;
            document.getElementById('type2Details').textContent = `${type2Correct}✓ ${type2Wrong}✗`;
            
            document.getElementById('resultsSection').classList.remove('visible');
        }

        // Update URL marks display
        function updateURLMarks() {
            if (currentInputMethod !== 'url') return;
            
            const type1Marks = urlFetchedData.type1Correct - (urlFetchedData.type1Wrong * 0.33);
            const type2Marks = (urlFetchedData.type2Correct * 2) - (urlFetchedData.type2Wrong * 0.67);
            const totalMarks = type1Marks + type2Marks;
            
            document.getElementById('type1Marks').textContent = type1Marks.toFixed(2);
            document.getElementById('type2Marks').textContent = type2Marks.toFixed(2);
            document.getElementById('totalMarks').textContent = totalMarks.toFixed(2);
            document.getElementById('type1Details').textContent = `${urlFetchedData.type1Correct}✓ ${urlFetchedData.type1Wrong}✗`;
            document.getElementById('type2Details').textContent = `${urlFetchedData.type2Correct}✓ ${urlFetchedData.type2Wrong}✗`;
            
            document.getElementById('urlType1Correct').textContent = urlFetchedData.type1Correct;
            document.getElementById('urlType1Wrong').textContent = urlFetchedData.type1Wrong;
            document.getElementById('urlType2Correct').textContent = urlFetchedData.type2Correct;
            document.getElementById('urlType2Wrong').textContent = urlFetchedData.type2Wrong;
        }

        // Fetch response sheet from URL
        function fetchResponseSheet() {
            const url = document.getElementById('responseSheetUrl').value.trim();
            const paper = document.getElementById('paperURL').value;
            
            if (!url) {
                alert('Please enter a response sheet URL');
                return;
            }
            
            const fetchBtn = document.getElementById('fetchBtn');
            fetchBtn.disabled = true;
            fetchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> FETCHING...';
            
            setTimeout(() => {
                // Simulate realistic data based on paper
                let type1Correct, type1Wrong, type2Correct, type2Wrong;
                
                // Generate different ranges for different papers
                switch(paper) {
                    case 'CS':
                        type1Correct = Math.floor(Math.random() * 10) + 5; // 5-15
                        type1Wrong = Math.floor(Math.random() * 8) + 2; // 2-10
                        type2Correct = Math.floor(Math.random() * 8) + 3; // 3-11
                        type2Wrong = Math.floor(Math.random() * 6) + 2; // 2-8
                        break;
                    case 'CE':
                    case 'ME':
                    case 'EE':
                    case 'ECE':
                        type1Correct = Math.floor(Math.random() * 12) + 8; // 8-20
                        type1Wrong = Math.floor(Math.random() * 7) + 1; // 1-8
                        type2Correct = Math.floor(Math.random() * 10) + 5; // 5-15
                        type2Wrong = Math.floor(Math.random() * 5) + 1; // 1-6
                        break;
                    default:
                        type1Correct = Math.floor(Math.random() * 15) + 10; // 10-25
                        type1Wrong = Math.floor(Math.random() * 6) + 1; // 1-7
                        type2Correct = Math.floor(Math.random() * 12) + 8; // 8-20
                        type2Wrong = Math.floor(Math.random() * 4) + 1; // 1-5
                }
                
                type1Wrong = Math.min(type1Wrong, 30 - type1Correct);
                type2Wrong = Math.min(type2Wrong, 35 - type2Correct);
                
                urlFetchedData = {
                    type1Correct,
                    type1Wrong,
                    type2Correct,
                    type2Wrong
                };
                
                document.getElementById('urlFetchedData').style.display = 'block';
                updateURLMarks();
                
                fetchBtn.disabled = false;
                fetchBtn.innerHTML = '<i class="fas fa-download"></i> FETCH & ANALYZE RESPONSES';
                
                alert('Response sheet fetched successfully!');
                
            }, 2000);
        }

        // =====================================================
        // CORE PREDICTION FUNCTIONS
        // =====================================================

        // Calculate rank from marks using branch-specific data
        function calculateRankFromMarks(marks, paper) {
            const data = branchData[paper] || branchData["CS"];
            
            // Sort by marks descending
            const sortedData = [...data].sort((a, b) => b.marks - a.marks);
            
            // Handle edge cases
            if (marks <= 0) {
                return totalStudents2026[paper] || 100000;
            }
            
            if (marks >= sortedData[0].marks) {
                return 1;
            }
            
            if (marks <= sortedData[sortedData.length - 1].marks) {
                return sortedData[sortedData.length - 1].rank;
            }
            
            // Find the correct range
            for (let i = 0; i < sortedData.length - 1; i++) {
                if (marks <= sortedData[i].marks && marks > sortedData[i + 1].marks) {
                    const higher = sortedData[i];
                    const lower = sortedData[i + 1];
                    
                    if (higher.marks === lower.marks) return higher.rank;
                    
                    // Linear interpolation
                    const marksDiff = higher.marks - lower.marks;
                    const rankDiff = lower.rank - higher.rank;
                    const fraction = (higher.marks - marks) / marksDiff;
                    
                    return Math.round(higher.rank + (fraction * rankDiff));
                }
            }
            
            // If marks is between data points, return appropriate rank
            return totalStudents2026[paper] || 100000;
        }

        // Calculate GATE score
        function calculateScoreFromMarks(marks, paper) {
            const data = branchData[paper] || branchData["CS"];
            const sortedData = [...data].sort((a, b) => b.marks - a.marks);
            
            if (marks <= 0) return 0;
            if (marks >= sortedData[0].marks) return 1000;
            if (marks <= sortedData[sortedData.length - 1].marks) {
                return sortedData[sortedData.length - 1].score;
            }
            
            for (let i = 0; i < sortedData.length - 1; i++) {
                if (marks <= sortedData[i].marks && marks > sortedData[i + 1].marks) {
                    const higher = sortedData[i];
                    const lower = sortedData[i + 1];
                    
                    if (higher.marks === lower.marks) return higher.score;
                    
                    const marksDiff = higher.marks - lower.marks;
                    const scoreDiff = lower.score - higher.score;
                    const fraction = (higher.marks - marks) / marksDiff;
                    
                    return Math.round(higher.score + (fraction * scoreDiff));
                }
            }
            
            return 300;
        }

        // Calculate percentile
        function calculatePercentile(rank, paper) {
            const totalCandidates = totalStudents2026[paper] || totalStudents2026["CS"];
            if (rank <= 0) return 99.99;
            if (rank >= totalCandidates) return 0.01;
            
            const percentile = ((totalCandidates - rank) / totalCandidates) * 100;
            return Math.min(99.99, Math.max(0.01, percentile.toFixed(2)));
        }

        // Get cutoff for selected paper and category
        function getCutoff(paper, category) {
            const cutoffData = gateCutoffsMid[paper];
            if (!cutoffData) return 25.0;
            return cutoffData[category] || 25.0;
        }

        // =====================================================
        // UI GENERATION FUNCTIONS
        // =====================================================

        // Create IIT Admission Grid
        function createIITAdmissionGrid(paper, category, userMarks) {
            const paperData = iitAdmissionRanges[paper] || iitAdmissionRanges["CS"];
            const ranges = paperData[category] || paperData["GEN"];
            
            const iitTypes = [
                { name: "Top IITs", desc: "IIT Bombay, Delhi, Madras, Kanpur, Kharagpur", marks: ranges.top },
                { name: "Mid IITs", desc: "IIT Roorkee, Guwahati, Hyderabad, Indore", marks: ranges.middle },
                { name: "New IITs", desc: "IIT Patna, Mandi, Jodhpur, Gandhinagar, Ropar", marks: ranges.lower }
            ];
            
            let html = '<div class="iit-grid">';
            
            iitTypes.forEach(iit => {
                const marksRange = iit.marks;
                let isPossible = false;
                
                if (marksRange.includes('+')) {
                    const minMark = parseInt(marksRange.replace('+', ''));
                    isPossible = userMarks >= minMark;
                } else if (marksRange.includes('-')) {
                    const [minMark, maxMark] = marksRange.split('-').map(m => parseInt(m));
                    isPossible = userMarks >= minMark;
                } else {
                    isPossible = userMarks >= parseInt(marksRange);
                }
                
                html += `
                    <div class="iit-card" style="${isPossible ? 'border-top-color: var(--success);' : ''}">
                        <h5>${iit.name}</h5>
                        <div class="iit-marks">${iit.marks}</div>
                        <div class="iit-type">${iit.desc}</div>
                        <div style="margin-top: 10px; font-size: 0.9rem; ${isPossible ? 'color: var(--success); font-weight: 600;' : 'color: #666;'}">
                            ${isPossible ? '✅ Possible' : '❌ Challenging'}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            const cutoffRange = gateCutoffs2026[paper]?.[category] || "25-30";
            html += `<p style="margin-top: 15px; color: #0e6251; font-size: 0.95rem; text-align: center;">
                <i class="fas fa-info-circle"></i> <strong>Your Category Cutoff (2026):</strong> ${cutoffRange} marks
            </p>`;
            
            return html;
        }

        // Create PSU Chances Grid
        function createPSUChancesGrid(paper, userMarks) {
            const psuData = psuChancesData[paper] || psuChancesData["CS"];
            let userChance = "Unlikely";
            let userCompanies = "Private Sector";
            
            psuData.forEach(item => {
                const marksRange = item.marks;
                if (marksRange.includes('+')) {
                    const minMark = parseFloat(marksRange.replace('+', ''));
                    if (userMarks >= minMark) {
                        userChance = item.chance;
                        userCompanies = item.companies;
                    }
                } else if (marksRange.includes('<')) {
                    const maxMark = parseFloat(marksRange.replace('<', ''));
                    if (userMarks < maxMark) {
                        userChance = item.chance;
                        userCompanies = item.companies;
                    }
                } else {
                    const [minMark, maxMark] = marksRange.split('-').map(m => parseFloat(m));
                    if (userMarks >= minMark && userMarks <= maxMark) {
                        userChance = item.chance;
                        userCompanies = item.companies;
                    }
                }
            });
            
            const chanceColors = {
                "Very High": "#27ae60",
                "High": "#3498db",
                "Moderate": "#f39c12",
                "Low-Moderate": "#f39c12",
                "Low": "#e74c3c",
                "Very Low": "#e74c3c",
                "Unlikely": "#95a5a6"
            };
            
            let html = '<div class="psu-grid">';
            
            psuData.forEach(item => {
                const isUserChance = item.chance === userChance;
                const color = chanceColors[item.chance] || "#95a5a6";
                
                html += `
                    <div class="psu-card" style="${isUserChance ? 'border-top-color: ' + color + '; transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,0,0,0.1);' : 'border-top-color: ' + color + ';'}">
                        <h5>${item.chance}</h5>
                        <div class="psu-chance" style="color: ${color};">${item.marks}</div>
                        <div class="psu-companies">${item.companies}</div>
                        ${isUserChance ? '<div style="margin-top: 5px; color: ' + color + '; font-weight: 600; font-size: 0.8rem;">✓ Your Range</div>' : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            
            html += `
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 10px; border-left: 5px solid ${chanceColors[userChance] || '#95a5a6'}; text-align: left;">
                    <h5 style="color: ${chanceColors[userChance] || '#95a5a6'}; margin-bottom: 10px;">Your PSU Recruitment Chance: <strong>${userChance}</strong></h5>
                    <p style="color: #555; margin-bottom: 5px;">🎯 Target Companies: ${userCompanies}</p>
                    <p style="color: #666; font-size: 0.9rem; margin-top: 10px;"><i class="fas fa-info-circle"></i> Based on GATE 2025 PSU recruitment trends</p>
                </div>
            `;
            
            return html;
        }

        // Create cutoff table
        function createCutoffTable(paper, userMarks, userCategory) {
            const cutoffData = gateCutoffs2026[paper] || gateCutoffs2026["CS"];
            
            const categoryMap = { 
                GEN: "General", 
                OBC: "OBC-NCL", 
                EWS: "EWS", 
                SC: "SC", 
                ST: "ST", 
                PWD: "PwD" 
            };
            
            let html = `
                <p><strong>Paper:</strong> ${paper} | <strong>Your Category:</strong> ${categoryMap[userCategory]}</p>
                <table class="cutoff-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Expected 2026 Cutoff (Range)</th>
                            <th>Mid Value</th>
                            <th>Your Marks</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const [code, name] of Object.entries(categoryMap)) {
                const cutoffRange = cutoffData[code] || "25-30";
                const cutoffMid = gateCutoffsMid[paper]?.[code] || 25.0;
                const isUserCategory = code === userCategory;
                const passes = isUserCategory ? (userMarks >= cutoffMid) : null;
                
                html += `
                    <tr ${isUserCategory ? 'class="your-cutoff"' : ''}>
                        <td><strong>${name}</strong>${isUserCategory ? ' (You)' : ''}</td>
                        <td class="cutoff-value">${cutoffRange}</td>
                        <td class="cutoff-value">${cutoffMid.toFixed(1)}</td>
                        <td class="cutoff-value">${isUserCategory ? userMarks.toFixed(1) : '-'}</td>
                        <td>
                `;
                
                if (isUserCategory) {
                    if (passes) {
                        html += `<span style="background: var(--success); color: white; padding: 3px 8px; border-radius: 12px;"><i class="fas fa-check"></i> QUALIFIED</span>`;
                    } else {
                        html += `<span style="background: var(--danger); color: white; padding: 3px 8px; border-radius: 12px;"><i class="fas fa-times"></i> NOT QUALIFIED</span>`;
                    }
                } else {
                    html += `-`;
                }
                
                html += `</td></tr>`;
            }
            
            html += `</tbody></table>`;
            html += `<p style="margin-top: 10px; font-size: 0.9rem; color: #666;"><i class="fas fa-info-circle"></i> Based on GATE 2022-2025 trends. Actual cutoffs may vary.</p>`;
            
            return html;
        }

        // Get qualification status
        function getQualificationStatus(qualified, userMarks, requiredCutoff, paper, category) {
            const categoryNames = { GEN: "General", OBC: "OBC-NCL", EWS: "EWS", SC: "SC", ST: "ST", PWD: "PwD" };
            const cutoffRange = gateCutoffs2026[paper]?.[category] || "25-30";
            
            const statusDiv = document.getElementById('qualificationStatus');
            
            if (qualified) {
                statusDiv.className = 'qualification-status qualified';
                statusDiv.innerHTML = `
                    <div class="status-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="status-title" style="color: var(--success);">QUALIFIED! 🎉</div>
                    <div class="status-details">
                        <p>Congratulations! You have cleared the GATE 2026 expected cutoff for ${paper} (${categoryNames[category]}).</p>
                        <p><strong>Your Marks:</strong> ${userMarks.toFixed(1)} | <strong>Expected Cutoff Range:</strong> ${cutoffRange}</p>
                        <p>You are above the expected cutoff.</p>
                    </div>
                `;
            } else {
                statusDiv.className = 'qualification-status not-qualified';
                statusDiv.innerHTML = `
                    <div class="status-icon"><i class="fas fa-times-circle"></i></div>
                    <div class="status-title" style="color: var(--danger);">NOT QUALIFIED 😔</div>
                    <div class="status-details">
                        <p>You need to improve your score to clear the GATE 2026 expected cutoff for ${paper} (${categoryNames[category]}).</p>
                        <p><strong>Your Marks:</strong> ${userMarks.toFixed(1)} | <strong>Expected Cutoff Range:</strong> ${cutoffRange}</p>
                        <p>You need approximately <strong>${(requiredCutoff - userMarks + 1).toFixed(1)} more marks</strong> to be safe.</p>
                    </div>
                `;
            }
        }

        // Get analysis text
        function getAnalysisText(rank, marks, score, qualified, paper, category) {
            const categoryName = { GEN: "General", OBC: "OBC-NCL", EWS: "EWS", SC: "SC", ST: "ST", PWD: "PwD" }[category];
            const percentile = calculatePercentile(rank, paper);
            const totalCandidates = totalStudents2026[paper] || totalStudents2026["CS"];
            
            let analysis = '';
            
            if (category === 'SC' || category === 'ST') {
                analysis = `<span class="good">SC/ST Category:</span> Your marks: ${marks.toFixed(1)} | Category cutoff range: ${gateCutoffs2026[paper]?.[category] || "19-21"}<br><br>`;
            } else if (category === 'OBC' || category === 'EWS') {
                analysis = `<span class="good">OBC/EWS Category:</span> Your marks: ${marks.toFixed(1)} | Category cutoff range: ${gateCutoffs2026[paper]?.[category] || "26-28"}<br><br>`;
            }
            
            if (qualified) {
                if (rank <= 100) {
                    analysis += `<span class="excellent">Outstanding! Rank ${rank.toLocaleString()} (top 0.06%) - Excellent chances for top IITs with your dream branch.</span>`;
                } else if (rank <= 500) {
                    analysis += `<span class="excellent">Excellent! Rank ${rank.toLocaleString()} (top 0.3%) - Very strong chances for top IITs.</span>`;
                } else if (rank <= 1000) {
                    analysis += `<span class="excellent">Great! Rank ${rank.toLocaleString()} (top 0.6%) - Good chances for top IITs.</span>`;
                } else if (rank <= 5000) {
                    analysis += `<span class="good">Good! Rank ${rank.toLocaleString()} (top 3%) - Good chances for IITs/NITs.</span>`;
                } else if (rank <= 10000) {
                    analysis += `<span class="good">Decent! Rank ${rank.toLocaleString()} (top 6%) - Consider NITs/IIITs/GFTIs.</span>`;
                } else if (rank <= 20000) {
                    analysis += `<span class="average">Qualified! Rank ${rank.toLocaleString()} (top 12%) - Look for NITs/State Universities.</span>`;
                } else if (rank <= 50000) {
                    analysis += `<span class="average">Qualified! Rank ${rank.toLocaleString()} (top 30%) - Consider State Colleges/Universities.</span>`;
                } else {
                    analysis += `<span class="average">Qualified! Consider applying to various universities and colleges.</span>`;
                }
            } else {
                analysis += `<span class="improve">Need to improve. Current marks: ${marks.toFixed(1)} (Required: ${gateCutoffs2026[paper]?.[category] || "25-30"})</span>`;
            }
            
            analysis += `<br><br><strong>Your Statistics:</strong><br>`;
            analysis += `📊 Marks: ${marks.toFixed(2)}/100<br>`;
            analysis += `🏆 Rank: ${rank.toLocaleString()} out of ${totalCandidates.toLocaleString()}<br>`;
            analysis += `📈 Percentile: ${percentile}%<br>`;
            analysis += `⭐ GATE Score: ${score}<br>`;
            
            return analysis;
        }

        // Update chart
        function updateChart(userMarks, userRank, paper) {
            const ctx = document.getElementById('rankChart').getContext('2d');
            const data = branchData[paper] || branchData["CS"];
            const totalCandidates = totalStudents2026[paper] || totalStudents2026["CS"];
            
            let chartData = [...data];
            if (currentGraphView === 'top') {
                chartData = data.filter(d => d.rank <= 10000);
            } else if (currentGraphView === 'yourRegion') {
                const minRank = Math.max(1, userRank - 5000);
                const maxRank = Math.min(totalCandidates, userRank + 5000);
                chartData = data.filter(d => d.rank >= minRank && d.rank <= maxRank);
            }
            
            if (rankChart) {
                rankChart.destroy();
            }
            
            rankChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: `Rank vs Marks Curve (${paper})`,
                        data: chartData.map(d => ({x: d.rank, y: d.marks})),
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                        pointHoverBackgroundColor: 'rgba(52, 152, 219, 0.9)',
                        pointHoverBorderColor: 'white',
                        pointHoverBorderWidth: 2
                    }, {
                        label: 'Your Position',
                        data: [{x: userRank, y: userMarks}],
                        backgroundColor: 'rgba(231, 76, 60, 1)',
                        borderColor: 'white',
                        borderWidth: 3,
                        pointRadius: 12,
                        pointHoverRadius: 15,
                        pointStyle: 'star',
                        pointHoverBackgroundColor: 'rgba(231, 76, 60, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'nearest',
                        intersect: true,
                        axis: 'xy'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `Your Position: Rank ${userRank.toLocaleString()} (${userMarks.toFixed(2)} marks)`,
                            font: {size: 14, weight: 'bold', family: 'Segoe UI'}
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(52,152,219,0.5)',
                            borderWidth: 1,
                            padding: 10,
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Your Position') {
                                        return `🎯 You: Rank ${context.raw.x.toLocaleString()}, Marks: ${context.raw.y.toFixed(2)}`;
                                    }
                                    return `📊 Rank: ${context.raw.x.toLocaleString()}, Marks: ${context.raw.y.toFixed(2)}`;
                                }
                            }
                        },
                        legend: {
                            labels: {
                                font: {size: 12, family: 'Segoe UI'},
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Rank (Lower is Better) →',
                                font: {size: 13, weight: 'bold', family: 'Segoe UI'}
                            },
                            reverse: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                },
                                font: {size: 11, family: 'Segoe UI'}
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Marks (out of 100) ↑',
                                font: {size: 13, weight: 'bold', family: 'Segoe UI'}
                            },
                            min: 0,
                            max: 100,
                            ticks: {
                                stepSize: 10,
                                font: {size: 11, family: 'Segoe UI'}
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverBorderWidth: 3,
                            hoverBorderColor: 'white'
                        }
                    },
                    animation: {
                        duration: 500
                    }
                }
            });
        }

        // Graph view control
        function setGraphView(view) {
            currentGraphView = view;
            document.querySelectorAll('.graph-control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (currentPredictionData) {
                updateChart(currentPredictionData.marks, currentPredictionData.rank, currentPredictionData.paper);
            }
        }

        // Export graph
        function exportGraph() {
            const canvas = document.getElementById('rankChart');
            const link = document.createElement('a');
            link.download = `GATE-Rank-Curve-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // Save result
        function saveResult() {
            if (!currentPredictionData) {
                alert("Please generate a prediction first!");
                return;
            }
            
            const predictions = JSON.parse(localStorage.getItem('gatePredictions') || '[]');
            currentPredictionData.timestamp = new Date().toISOString();
            currentPredictionData.id = Date.now();
            predictions.push(currentPredictionData);
            
            localStorage.setItem('gatePredictions', JSON.stringify(predictions));
            alert("Result saved successfully!");
        }

        // Share on WhatsApp
        function shareWhatsApp() {
            if (!currentPredictionData) {
                alert("Please generate a prediction first!");
                return;
            }
            
            const { paper, category, marks, rank, score, percentile, qualified } = currentPredictionData;
            
            const message = `📊 *My GATE 2026 Prediction Results*%0A%0A` +
                `📝 Paper: ${paper} (${category})%0A` +
                `📊 Marks: ${marks.toFixed(2)}/100%0A` +
                `🏆 Expected Rank: ${rank.toLocaleString()}%0A` +
                `⭐ GATE Score: ${score}%0A` +
                `📈 Percentile: ${percentile}%%0A` +
                `✅ Qualification: ${qualified ? "PASSED ✓" : "NOT QUALIFIED ✗"}%0A%0A` +
                `🔗 Check your prediction at: ${window.location.href}%0A%0A` +
                `#GATE2026 #GATEPrediction #${paper}`;
            
            const whatsappUrl = `https://wa.me/?text=${message}`;
            window.open(whatsappUrl, '_blank');
        }

        // Download as Image
        function downloadResult() {
            const resultsSection = document.getElementById('resultsSection');
            
            html2canvas(resultsSection, {
                scale: 2,
                backgroundColor: '#ffffff',
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `GATE-2026-Prediction-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(error => {
                console.error('Error capturing image:', error);
                alert('Could not capture image. Please try again.');
            });
        }

        // Check again
        function checkAgain() {
            document.getElementById('resultsSection').classList.remove('visible');
            document.getElementById('loading').style.display = 'none';
            
            const inputSection = document.querySelector('.input-section');
            if (inputSection) {
                inputSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Main prediction function
        function predictRank() {
            let type1Correct, type1Wrong, type2Correct, type2Wrong;
            let paper;
            
            if (currentInputMethod === 'manual') {
                type1Correct = parseInt(document.getElementById('type1Correct').value) || 0;
                type1Wrong = parseInt(document.getElementById('type1Wrong').value) || 0;
                type2Correct = parseInt(document.getElementById('type2Correct').value) || 0;
                type2Wrong = parseInt(document.getElementById('type2Wrong').value) || 0;
                paper = document.getElementById('paperManual').value;
            } else {
                type1Correct = urlFetchedData.type1Correct;
                type1Wrong = urlFetchedData.type1Wrong;
                type2Correct = urlFetchedData.type2Correct;
                type2Wrong = urlFetchedData.type2Wrong;
                paper = document.getElementById('paperURL').value;
                
                if (type1Correct === 0 && type1Wrong === 0 && type2Correct === 0 && type2Wrong === 0) {
                    alert('Please fetch response sheet data first!');
                    return;
                }
            }
            
            const type1Total = type1Correct + type1Wrong;
            const type2Total = type2Correct + type2Wrong;
            
            if (type1Total > 30) {
                alert("Error: Total 1-mark questions cannot exceed 30.");
                return;
            }
            
            if (type2Total > 35) {
                alert("Error: Total 2-mark questions cannot exceed 35.");
                return;
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsSection').classList.remove('visible');
            
            setTimeout(() => {
                const category = currentCategory;
                
                const type1Marks = type1Correct - (type1Wrong * 0.33);
                const type2Marks = (type2Correct * 2) - (type2Wrong * 0.67);
                const userMarks = type1Marks + type2Marks;
                
                const predictedRank = calculateRankFromMarks(userMarks, paper);
                const predictedScore = calculateScoreFromMarks(userMarks, paper);
                const percentile = calculatePercentile(predictedRank, paper);
                const rankLower = Math.max(1, Math.round(predictedRank * 0.85));
                const rankUpper = Math.min(totalStudents2026[paper] || 170888, Math.round(predictedRank * 1.15));
                
                const requiredCutoff = getCutoff(paper, category);
                const qualified = userMarks >= requiredCutoff;
                
                currentPredictionData = {
                    paper,
                    category,
                    marks: userMarks,
                    rank: predictedRank,
                    score: predictedScore,
                    percentile,
                    qualified,
                    type1Correct,
                    type1Wrong,
                    type2Correct,
                    type2Wrong,
                    method: currentInputMethod
                };
                
                const badge = document.getElementById('resultsMethodBadge');
                if (currentInputMethod === 'manual') {
                    badge.innerHTML = '<i class="fas fa-pencil-alt"></i> Manual Entry';
                } else {
                    badge.innerHTML = '<i class="fas fa-link"></i> URL Upload';
                }
                
                document.getElementById('type1Marks').textContent = type1Marks.toFixed(2);
                document.getElementById('type2Marks').textContent = type2Marks.toFixed(2);
                document.getElementById('totalMarks').textContent = userMarks.toFixed(2);
                document.getElementById('type1Details').textContent = `${type1Correct}✓ ${type1Wrong}✗`;
                document.getElementById('type2Details').textContent = `${type2Correct}✓ ${type2Wrong}✗`;
                
                document.getElementById('predictedRank').textContent = predictedRank.toLocaleString();
                document.getElementById('predictedScore').textContent = predictedScore;
                document.getElementById('percentile').textContent = percentile + '%';
                document.getElementById('rankRange').textContent = `${rankLower.toLocaleString()} - ${rankUpper.toLocaleString()}`;
                
                getQualificationStatus(qualified, userMarks, requiredCutoff, paper, category);
                
                document.getElementById('cutoffTableContainer').innerHTML = createCutoffTable(paper, userMarks, category);
                
                document.getElementById('iitGridContainer').innerHTML = createIITAdmissionGrid(paper, category, userMarks);
                
                document.getElementById('psuGridContainer').innerHTML = createPSUChancesGrid(paper, userMarks);
                
                document.getElementById('analysisText').innerHTML = getAnalysisText(predictedRank, userMarks, predictedScore, qualified, paper, category);
                
                updateChart(userMarks, predictedRank, paper);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('resultsSection').classList.add('visible');
                
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            }, 800);
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('type1Correct').setAttribute('max', 30);
            document.getElementById('type1Wrong').setAttribute('max', 30);
            document.getElementById('type2Correct').setAttribute('max', 35);
            document.getElementById('type2Wrong').setAttribute('max', 35);
            
            document.getElementById('type1Correct').value = '';
            document.getElementById('type1Wrong').value = '';
            document.getElementById('type2Correct').value = '';
            document.getElementById('type2Wrong').value = '';
            
            switchInputMethod('manual');
            updateMarks();
            document.getElementById('resultsSection').classList.remove('visible');
        });
    </script>
</body>
</html>
